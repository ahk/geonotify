function get$(A){return document.getElementById(A)}function GeometryControls(C){var A=this;A.Options={controlPostitionFloat:G_ANCHOR_TOP_RIGHT,controlPosition:[0,0],buttonWidth:"33",buttonHeight:"33",buttonBorder:"0",buttonCursor:"pointer",infoWindowHtmlURL:"data/geometry_html_template.html",stylesheets:["styles/google.maps.base.css","styles/google.maps.ms_styles.css"],autoSave:true,cssId:"emmc-geom",debug:true};if(C){for(var B in C){A.Options[B]=C[B]}}else{}A.isIE=navigator.appName.indexOf("Explorer")>-1;A.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;A.map=null;A.container=null;A.controls={};A.buttons_={};A.stopDigitizingFuncs_={};A.infoWindowHtmlTemplates={};A.bounds=new GLatLngBounds();A.autoSaveListener=null;A.runInitFunctions_()}GeometryControls.prototype=new GControl();GeometryControls.prototype.runInitFunctions_=function(){var A=this;A.getInfoWindowHtml_();A.addGoogleMapsCSS_();if(A.Options.autoSave){A.addAutoSaveAspect()}};GeometryControls.prototype.getDefaultPosition=function(D){var B=this,A=B.Options,C;if(D){C=new GControlPosition(D.controlPositionFloat,new GSize(D.controlPosition[0],D.controlPosition[1]))}else{C=new GControlPosition(A.controlPositionFloat,new GSize(A.controlPosition[0],A.controlPosition[1]))}return C};GeometryControls.prototype.initialize=function(C){var B=this;B.map=C;B.container=document.createElement("div");C.getContainer().appendChild(B.container);for(var A in B.controls){C.addControl(B.controls[A])}C.getInfoWindow();return B.container};GeometryControls.prototype.createButton=function(D){var F=this,E=D,A=F.Options;if(typeof (E.startDigitizing)&&typeof (E.stopDigitizing)!=="function"){F.debug("Digitizing functions for #createButton are required");return }var C={};C.opts=E.button_opts;var B=document.createElement("img");B.style.cursor=C.opts.buttonCursor||A.buttonCursor;B.width=C.opts.buttonWidth||A.buttonWidth;B.height=C.opts.buttonHeight||A.buttonHeight;B.border=C.opts.buttonBorder||A.buttonBorder;B.src=C.opts.img_up_url;B.title=C.opts.tooltip;C.img=B;GEvent.addDomListener(C.img,"click",function(){if(C.img.getAttribute("src")===C.opts.img_up_url){F.toggleButtons(E.controlName);E.startDigitizing()}else{F.toggleButtons(E.controlName);E.stopDigitizing()}});F.buttons_[E.controlName]=C;F.stopDigitizingFuncs_[E.controlName]=E.stopDigitizing;return C};GeometryControls.prototype.toggleButtons=function(A){var D=this;for(var B in D.buttons_){D.buttons_[B].img.src=D.buttons_[B].opts.img_up_url}if(A){D.buttons_[A].img.src=D.buttons_[A].opts.img_down_url}if(A){for(var C in D.stopDigitizingFuncs_){if(C!=A){D.stopDigitizingFuncs_[C](false)}}}};GeometryControls.prototype.addControl=function(B){var A=this;B.zuper=A;A.controls[B.name]=B};GeometryControls.prototype.tooltipFactory=function(B){var F=this,G=F.map;var C=document.createElement("div");C.id="tooltipContainer";C.className="emmc-tooltip";G.getContainer().appendChild(C);var D=function(N,J){var M=G.getCurrentMapType().getProjection().fromLatLngToPixel(G.getBounds().getSouthWest(),G.getZoom());var I=G.getCurrentMapType().getProjection().fromLatLngToPixel(N,G.getZoom());var K=new GPoint(B.anchor[0],B.anchor[1]);var L=-12;var H=new GControlPosition(G_ANCHOR_BOTTOM_LEFT,new GSize(I.x-M.x-K.x+L,-I.y+M.y+K.y));H.apply(J)};var A=function(){if(B.cursor_on!==""&&!F.isChrome){var H=F.map.getDragObject();return function(){H.setDraggableCursor(B.cursor_on)}}else{return function(){}}}();var E={me:F,tooltip_opts:B,tooltipHandler:null,tooltipContainer:C,on:function(H,J){var I=this;C.innerHTML=H;C.style.display="block";this.tooltipHandler=GEvent.addListener(I.me.map,"mousemove",function(K){D(K,C);A();if(typeof (J)==="function"){J(K,C)}})},off:function(){this.me.map.getDragObject().setDraggableCursor(this.tooltip_opts.cursor_off);C.style.display="none";try{GEvent.removeListener(this.tooltipHandler)}catch(H){}}};F.tooltip=function(H){E.tooltip_opts=H;return E};return E};GeometryControls.prototype.showColorPicker=function(opts){var me=this,row,cell;var colors=eval(me.infoWindowHtmlTemplates["colorTable"]);var div=document.createElement("div");document.getElementsByTagName("body")[0].appendChild(div);div.innerHTML=me.infoWindowHtmlTemplates["colorTableHtml"];var colorPicker=get$("emmc-menu-color");var colorPickerTable=get$("emmc-color-table");row=colorPickerTable.insertRow(0);for(var i in colors){if(i%7===0&&i!==0){row=colorPickerTable.insertRow(i/7)}cell=row.insertCell(i%7);cell.innerHTML='<div id="menu_cp_'+colors[i]+'" bgcolor="'+colors[i]+'" style="border: 1px solid rgb(187, 187, 187); margin: 0px;padding: 0px; width: 15px; height: 15px; background-color:'+colors[i]+'" unselectable="on"><img height="1" width="1"/></div>'}var target,color,callback;var colorPickerHandler=GEvent.addDomListener(colorPicker,"mouseover",function(){var tempHandler=GEvent.addDomListener(me.map.getInfoWindow().getContentContainers()[0],"mouseover",function(){colorPicker.style.display="none";GEvent.removeListener(tempHandler)});var tempHandler2=GEvent.addListener(me.map,"infowindowclose",function(){colorPicker.style.display="none";GEvent.removeListener(tempHandler2)})});var cells=colorPickerTable.getElementsByTagName("div");for(var j=0;j<cells.length;j++){var td=cells[j];GEvent.addDomListener(td,"mouseover",function(){this.style.borderColor="#FFFFFF"});GEvent.addDomListener(td,"mouseout",function(){this.style.borderColor="#BBBBBB"});GEvent.addDomListener(td,"click",function(){color=this.getAttribute("bgColor");target.setAttribute("bgColor",color);target.style.backgroundColor=color;colorPicker.style.display="none";callback(color)})}var newFunc=function(opts){var position=me.getAbsolutePosition(opts.target);colorPicker.style.left=position.x+1+"px";colorPicker.style.top=position.y+"px";colorPicker.style.display="block";colorPicker.focus();target=opts.target;callback=opts.callback;return colorPicker};colors=colorPickerTable=row=cells=null;me.showColorPicker=newFunc;return newFunc(opts)};GeometryControls.prototype.addGoogleMapsCSS_=function(){var C=this,B;var D=function(E){try{document.getElementsByTagName("head")[0].appendChild(E)}catch(F){C.debug("Having trouble adding stylesheets, trying again....");setTimeout(function(){D(E)},100)}};for(var A=0;A<C.Options.stylesheets.length;A++){B=document.createElement("link");B.setAttribute("href",C.Options.stylesheets[A]);B.setAttribute("rel","stylesheet");B.setAttribute("type","text/css");D(B)}B=null};GeometryControls.prototype.getInfoWindowHtml_=function(){var me=this;var trim=function(stringToTrim){return stringToTrim.replace(/^\s+|\s+$/g,"")};var processHtml=function(doc){var nodes=doc.getElementsByTagName("script");if(nodes.length>=1){for(var i=0;i<nodes.length;i++){var str=nodes[i].getAttribute("id");var content=trim((me.isIE)?nodes[i].childNodes[0].data:nodes[i].textContent);me.infoWindowHtmlTemplates[str]=(nodes[i].getAttribute("evalRequired")==="true")?eval(content):content}}else{me.debug("GeometryControls#getInfoWindowHtml says: failed to get html from template")}};try{var request=GXmlHttp.create();request.open("GET",me.Options.infoWindowHtmlURL,false);request.send(null);var doc=GXml.parse(request.responseText);processHtml(doc)}catch(e){me.debug("GeometryControls#getInfoWindowHtml says: looks like you provided an invalid URL. The URL is "+me.Options.infoWindowHtmlURL+" The error is: "+e+" "+e.description)}};GeometryControls.prototype.parseMicroTemplate=function(E,D,C){var B={};this.parseMicroTmpl=function A(J,I,H){var G=(typeof (H)!=="undefined")?H:J;var F=!/\W/.test(J)?B[J]=B[J]||A(G):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+J.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return I?F(I):F};return this.parseMicroTmpl(E,D,C)};GeometryControls.prototype.bindInfoWindow=function(C){var J=this,B=J.map,G=C.index,I=J.Options.cssId;var E=C.storage[G];var K=E.geometry;var M=E.title;var N=E.description;var L=get$("msiwsi");var O=get$(I+"-style");var D=get$(I+"-title");var A=get$(I+"-description");var H=false;GEvent.addDomListener(L,"click",function(){O.style.display="block";if(H===false){C.geometryStyleFunc();H=true}});GEvent.addDomListener(get$("emmc-geom-style-back"),"click",function(){O.style.display="none"});D.value=(M[1])?((M[0]===M[1])?M[0]:M[1]):"";A.value=(N[1])?((N[0]===N[1])?N[0]:N[1]):"";GEvent.addDomListener(D,"change",function(){M[1]=D.value});GEvent.addDomListener(A,"change",function(){N[1]=A.value});var F=GEvent.addListener(B,"infowindowbeforeclose",function(){M[1]=D.value;N[1]=A.value;GEvent.removeListener(F)});GEvent.addDomListener(get$(I+"-delete"),"click",function(){if(confirm("Are you sure you want to delete this?")){B.removeOverlay(K);C.storage[G]=null;B.closeInfoWindow()}});GEvent.addDomListener(get$(I+"-cancel"),"click",function(){C.undoStyling();M[1]=M[0];N[1]=N[0];GEvent.removeListener(F);B.closeInfoWindow()});GEvent.addDomListener(get$(I+"-ok"),"click",function(){M[0]=M[1];N[0]=N[1];C.commitStyling();B.closeInfoWindow()})};GeometryControls.prototype.loadData=function(B){var A=this;GDownloadUrl(B.url,function(D,C){(B.type==="kml")?A.handleKmlDataResponse_(D,C):A.handleJsonDataResponse_(D,C)})};GeometryControls.prototype.handleKmlDataResponse_=function(t,b){var Q=this;var h={value:function(i){a=GXml.value(i);a=a.replace(/^\s*/,"");a=a.replace(/\s*$/,"");return a},styles:{}};function T(i){Q.debug("Looks like you provided an invalid URL or parameters or invalid xml. The URL is  ____ .The error is:"+i+" at line "+i.lineNumber+" in file "+i.fileName)}if(b==200){try{var K=GXml.parse(t);var V=K.documentElement.getElementsByTagName("Style");for(var o=0;o<V.length;o++){var F=V[o].getAttribute("id");var u=V[o].getElementsByTagName("Icon");if(u.length>0){var R=h.value(u[0].getElementsByTagName("href")[0]);if(!!R){var H={name:F};var S={};for(var m in Q.infoWindowHtmlTemplates["markerIcons"]){S[Q.infoWindowHtmlTemplates["markerIcons"][m].name]=Q.infoWindowHtmlTemplates["markerIcons"][m]}switch(true){case (R.indexOf("kml")>-1):H.y=parseInt(R.charAt(R.indexOf("pal")+3))+1;H.x=parseInt(R.substring(R.indexOf("icon")+4,R.indexOf(".png")));break;case (R.indexOf("dot")>-1):H.y=0;if(S["dot"]){var C=S["dot"].images;var D=R.split("/").pop();for(var l in C){if(D===C[l]){H.x=l}}}else{Q.debug("Cannot Load Kml - There is no icon defined for markers with images like *-dot.png")}break}}h.styles["#"+H.name]=H}var X=V[o].getElementsByTagName("LineStyle");if(X.length>0){var B=parseInt(GXml.value(X[0].getElementsByTagName("width")[0]));if(B<1){B=5}var U=h.value(X[0].getElementsByTagName("color")[0]);var O=U.substr(0,2);var v=U.substr(2,2);var L=U.substr(4,2);var W=U.substr(6,2);U="#"+W+L+v;var q=parseInt(O,16)/256;if(!h.styles["#"+F]){h.styles["#"+F]={}}h.styles["#"+F].color=U;h.styles["#"+F].width=B;h.styles["#"+F].opacity=q}var r=V[o].getElementsByTagName("PolyStyle");if(r.length>0){var P=parseInt(GXml.value(r[0].getElementsByTagName("fill")[0]));var E=parseInt(GXml.value(r[0].getElementsByTagName("outline")[0]));var U=h.value(r[0].getElementsByTagName("color")[0]);if(r[0].getElementsByTagName("fill").length===0){P=1}if(r[0].getElementsByTagName("outline").length===0){E=1}var O=U.substr(0,2);var v=U.substr(2,2);var L=U.substr(4,2);var W=U.substr(6,2);U="#"+W+L+v;var q=Math.round((parseInt(O,16)/256)*100)/100;if(!h.styles["#"+F]){h.styles["#"+F]={}}h.styles["#"+F].fillcolor=U;h.styles["#"+F].fillopacity=q;if(!P){h.styles["#"+F].fillopacity=0}if(!E){h.styles["#"+F].opacity=0}}}var n=K.documentElement.getElementsByTagName("Placemark");for(var o=0;o<n.length;o++){var J=h.value(n[o].getElementsByTagName("name")[0]);var c=h.value(n[o].getElementsByTagName("description")[0]);if(c.match(/^http:\/\//i)){c='<a href="'+c+'">'+c+"</a>"}if(c.match(/^https:\/\//i)){c='<a href="'+c+'">'+c+"</a>"}var g=h.styles[h.value(n[o].getElementsByTagName("styleUrl")[0])]||{};var G=GXml.value(n[o].getElementsByTagName("coordinates")[0]);G=G.replace(/\s+/g," ");G=G.replace(/^ /,"");G=G.replace(/ $/,"");G=G.replace(/, /,",");var d=G.split(" ");if(d.length>1){var Z=[];for(var f=0;f<d.length;f++){var N=d[f].split(",");var Y=new GLatLng(parseFloat(N[1]),parseFloat(N[0]));Z.push(Y);Q.bounds.extend(Y)}var I=n[o].getElementsByTagName("LineString");if(I.length){if(g.width){g.width=5;g.color="#0000ff";g.opacity=0.45}Q.createGeometry_({type:"line",coordinates:Z,title:J,description:c,style:{strokeColor:g.fillcolor,strokeWeight:3,strokeOpacity:g.fillopacity,opts:{clickable:true}}})}var w=n[o].getElementsByTagName("Polygon");if(w.length){if(g.width){g.width=5;g.color="#0000ff";g.opacity=0.45;g.fillopacity=0.25;g.fillcolor="#0055ff"}Q.createGeometry_({type:"poly",coordinates:Z,title:J,description:c,style:{strokeColor:g.fillcolor,strokeWeight:3,strokeOpacity:g.fillopacity,fillColor:g.fillcolor,fillOpacity:g.fillopacity,opts:{clickable:true}}})}}else{var A=d[0].split(",");var M=Q.createGeometry_({type:"point",coordinates:[{lat:parseFloat(A[1]),lng:parseFloat(A[0])}],title:J,description:c,style:{icon:g}});Q.bounds.extend(M.getLatLng())}}Q.zoomToBounds()}catch(s){T(s)}}else{T()}};GeometryControls.prototype.handleJsonDataResponse_=function(data,responseCode){var me=this;if(responseCode==200){var json_data=eval("("+data+")");json_data=json_data[0];if(json_data.status!="success"){me.debug("The JSON was invalid");return }switch(json_data.operation){case"get":var geometries=json_data.result.geometries;for(var i=0;i<geometries.records.length;i++){var record=geometries.records[i];if(record.type==="point"){var geometry=me.createGeometry_(record);me.bounds.extend(geometry.getLatLng())}else{if(record.type==="line"||record.type=="poly"){var latlng,latlngArray=[];record.coordinates=function(){for(var i in record.coordinates){latlng=new GLatLng(record.coordinates[i].lat,record.coordinates[i].lng);latlngArray[i]=latlng}return latlngArray}();var geometry=me.createGeometry_(record);me.bounds.extend(geometry.getBounds().getCenter())}}}me.zoomToBounds()}}else{me.debug("Looks like you provided an invalid URL or parameters. The URL is ___")}};GeometryControls.prototype.zoomToBounds=function(A){var C=this,B=C.bounds;if(!B.isEmpty()){C.map.setCenter(B.getCenter());C.map.setZoom(C.map.getBoundsZoomLevel(B))}};GeometryControls.prototype.createGeometry_=function(A){var B=this;try{switch(A.type){case"point":return B.controls["markerControl"].loadMarkers(A);case"line":return B.controls["polylineControl"].loadPolylines(A);case"poly":return B.controls["polygonControl"].loadPolygons(A)}}catch(C){B.debug("A geometry Control has not been added for the geometry type you are trying to load or there is an error.Your error is: "+C+" at line "+C.lineNumber+" in file "+C.fileName)}};GeometryControls.prototype.addAutoSaveAspect=function(){var A=this;A.aop.addBefore(A,"bindInfoWindow",function(B){var C=B[0];A.autoSaveListener=C.commitStyling;C.commitStyling=function(){A.autoSaveListener()};A.aop.addAfter(A,"autoSaveListener",function(){if(A.Options.autoSave){A.saveData({allData:false,geomInfo:C})}});return B})};GeometryControls.prototype.saveData=function(A){var I=this;if(A.allData===true){}else{var D=A.geomInfo,H=A.geomInfo.index;var F=D.storage[H];var C={};C.type=F.type;C.coordinates=[];if(F.type==="point"){C.coordinates.push({lat:F.geometry.getLatLng().lat(),lng:F.geometry.getLatLng().lng()})}else{var G;for(var E=0;E<F.geometry.getVertexCount();E++){G=F.geometry.getVertex(E);C.coordinates.push({lat:G.lat(),lng:G.lng()})}}C.title=F.title[0];C.description=F.description[0];C.style=""}function B(J){I.debug(J)}B(I.serialize(C))};GeometryControls.prototype.saveAllData=function(){var A=this};GeometryControls.prototype.beans={Geometry:function(A){this.type=A.type;this.geometry=A.geometry;this.title=A.title||["",""];this.description=A.description||["",""]},Style:function(A){}};GeometryControls.prototype.setLocalTimeout=function(C,A){function B(){C()}setTimeout(B,A)};GeometryControls.prototype.getAbsolutePosition=function(A){for(var C=0,B=0;A!==null;C+=A.offsetLeft,B+=A.offsetTop,A=A.offsetParent){}return{x:C,y:B}};GeometryControls.prototype.convertFromMetric=function(A,C){var B=C+A||A;return(B<1609.344)?(B*3.2808399).toFixed(2)+"ft":(B*0.0006213711).toFixed(2)+"mi"};GeometryControls.prototype.debug=function(C){var A=this,B;if(A.Options.debug){B=function(D){GLog.write(D)}}else{B=function(){}}A.debug=B;return B(C)};GeometryControls.prototype.serialize=function(C){var B=this;var D=[];function A(E){for(var F in E){if(typeof (E[F])==="object"){A(E[F])}else{D.push(F+"="+E[F])}}}A(C);return D.join("&")};GeometryControls.prototype.aop={addBefore:function(D,A,C){var B=function(E){return function(){return E.apply(this,C(arguments,E,this))}};this.process_(D,A,B)},addAfter:function(C,A,D){var B=function(E){return function(){return D(E.apply(this,arguments),arguments,E,this)}};this.process_(C,A,B)},addAround:function(D,A,C){var B=function(E){return function(){return C(arguments,E,this)}};this.process_(D,A,B)},process_:function(D,B,C){var A;if(B.exec){A=function(F){return B.exec(F)}}else{if(B.call){A=function(F){return B.call(this,F)}}}if(A){for(var E in D){if(A(E)){this.attach_(D,E,C)}}}else{this.attach_(D,B,C)}},attach_:function(B,D,A){var C=B[D];B[D]=A(C)}}