function MarkerControl(D){var A=this;A.type="point";A.name="markerControl";A.zuper=null;A.clickHandler=null;A.icons={standard:new GIcon(G_DEFAULT_ICON,"images/blue-dot.png")};A.infoWindowHtml="";A.storage=[];A.Options={button_opts:{img_up_url:"http://www.google.com/intl/en_us/mapfiles/ms/t/Bmu.png",img_down_url:"http://www.google.com/intl/en_us/mapfiles/ms/t/Bmd.png",name:"point",tooltip:"Add a placemark"},position:{controlPosition:[175,3]},tooltip:{anchor:[-30,-8],cursor_on:"url(images/blue-dot.cur),default",cursor_off:"url(http://maps.google.com/intl/en_us/mapfiles/openhand.cur),default",title:"Click on the map to create a new marker"},newGeometryOptions:{icon:A.icons.standard,dragCrossMove:false,title:"Drag to move this placemark",clickable:true,draggable:true,bouncy:false,bounceGravity:1,autoPan:true},multiEdit:false,htmlTemplateParams:{},cssId:"emmc-marker",optionalGeometryListeners:null,autoSave:false};if(typeof (D)!="undefined"){for(var C in D){if(typeof (D[C])==="object"){for(var B in D[C]){A.Options[C][B]=D[C][B]}}else{A.Options[C]=D[C]}}}else{}}MarkerControl.prototype=new GControl();MarkerControl.prototype.getDefaultPosition=function(){var A=this;return A.zuper.getDefaultPosition(A.Options.position)};MarkerControl.prototype.initialize=function(C){var B=this;B.container=document.createElement("div");B.container.id="mymaps-control-"+B.Options.button_opts.name;var A=B.zuper.createButton({controlName:B.name,button_opts:B.Options.button_opts,startDigitizing:function(){B.startDigitizing()},stopDigitizing:function(D){B.stopDigitizing(D)}});B.container.appendChild(A.img);C.getContainer().appendChild(B.container);B.runInitFunctions();return B.container};MarkerControl.prototype.runInitFunctions=function(){var A=this;A.tooltip();A.assembleInfoWindowHtml(A.Options.htmlTemplateParams)};MarkerControl.prototype.startDigitizing=function(){var A=this,C=A.zuper,B=C.map;A.tooltip.on(A.Options.tooltip.title);A.clickHandler=GEvent.addListener(B,"click",function(E,F){var D=A.createMarker(F,A.infoWindowHtml);B.addOverlay(D);if(!A.Options.multiEdit){A.stopDigitizing();GEvent.trigger(D,"click")}else{}})};MarkerControl.prototype.stopDigitizing=function(A){var B=this;try{GEvent.removeListener(B.clickHandler)}catch(C){}B.tooltip.off();if(A!==false){B.zuper.toggleButtons()}};MarkerControl.prototype.tooltip=function(){var A=this;var B=A.zuper.tooltipFactory(A.Options.tooltip);A.tooltip=B;return B};MarkerControl.prototype.assembleInfoWindowHtml=function(B){var C=this,D=C.zuper,A=D.infoWindowHtmlTemplates;B=B||{};B["geometry_style_link"]=A["geometry_style_link_params"][0]["marker"];C.infoWindowHtml=D.parseMicroTemplate("template_1",B,A["template_1"])+A["marker_2"]};MarkerControl.prototype.createMarker=function(A,D,I,B){var G=this,H=G.Options;var F=(typeof (I)==="number")?false:true;var E=(F)?G.storage.length:I;var C=new GMarker(A,H.newGeometryOptions);C.index=E;C.storedIcon=B||H.newGeometryOptions.icon;G.addGeometryListeners(C,D);if(F){G.storage[E]=new G.zuper.beans.Geometry({type:"point",geometry:C})}else{G.storage[E].geometry=C}return C};MarkerControl.prototype.addGeometryListeners=function(A,B){var C=this;GEvent.addListener(A,"click",function(){A.openInfoWindowHtml(B);C.bindInfoWindow(A)});if(C.Options.optionalGeometryListeners){C.Options.optionalGeometryListeners()}};MarkerControl.prototype.markerTooltip=function(){};MarkerControl.prototype.bindInfoWindow=function(C){var E=this,B=E.Options,D=C.index;var F=(E.zuper.isIE)?get$("msiwsi").childNodes[0]:get$("msiwsi").childNodes[1];var A=C.getIcon();F.setAttribute("src",A.image);F.style.width=A.iconSize.width+"px";F.style.height=A.iconSize.height+"px";E.zuper.bindInfoWindow({index:D,storage:E.storage,geometryStyleFunc:function(){E.bindStyleInfoWindow(D)},undoStyling:function(){E.changeStyling(D,C.storedIcon)},commitStyling:function(){C.storedIcon=new GIcon(B.newGeometryOptions.icon)}})};MarkerControl.prototype.bindStyleInfoWindow=function(C){var E=this;var F=get$("msim-icons").getElementsByTagName("img");var B=E.storage[C].geometry;for(var D=0;D<F.length;D++){var A=F[D];GEvent.addDomListener(A,"mouseover",function(){this.style.borderColor="#3D69B1"});GEvent.addDomListener(A,"mouseout",function(){this.style.borderColor="#FFFFFF"});GEvent.addDomListener(A,"click",function(){var I=this.style.backgroundPosition.split(" ");var H=Math.abs(I[0].split("px")[0])/32;var J=Math.abs(I[1].split("px")[0])/32;var G=E.checkIconStatus(H,J);E.changeStyling(C,E.icons[G.name])})}};MarkerControl.prototype.checkIconStatus=function(C,F){var E=this,B=E.zuper.infoWindowHtmlTemplates;var A=B["markerIcons"][F]||B["markerIcons"][B["markerIcons"].length-1];switch(true){case (A.name!=="kml"):if(typeof (E.icons[A.name])==="undefined"){E.createIcon(A,C)}else{E.icons[A.name].image=A.imageUrl+A.images[C]}break;case (A.name==="kml"):var D=A.imageUrl+"pal"+(F-1)+"/icon"+C;if(typeof (E.icons[A.name])==="undefined"){A.shadow=D+"s.png";E.createIcon(A,D+".png")}else{E.icons[A.name].image=D+".png"}break}return A};MarkerControl.prototype.changeStyling=function(C,D){var E=this,F=E.zuper.map;var A=E.storage[C].geometry;E.Options.newGeometryOptions.icon=new GIcon(D);F.removeOverlay(A);var B=E.createMarker(A.getLatLng(),E.infoWindowHtml,C,A.getIcon());F.addOverlay(B);GEvent.trigger(B,"click")};MarkerControl.prototype.createIcon=function(D,C){var B=this;var A=new GIcon();A.image=(!isNaN(parseInt(C)))?D.imageUrl+D.images[C]:C;if(D.shadow){A.shadow=D.shadow;A.shadowSize=new GSize(D.shadowSize[0],D.shadowSize[1])}A.iconSize=new GSize(D.iconSize[0],D.iconSize[1]);A.iconAnchor=new GPoint(D.anchor[0],D.anchor[1]);A.infoWindowAnchor=new GPoint(D.wAnchor[0],D.wAnchor[1]);A.dragCrossAnchor=(typeof (D.dragCrossAnchor)!=="undefined")?new GPoint(D.dragCrossAnchor[0],D.dragCrossAnchor[1]):new GPoint(7,8);A.transparent=D.transparent||"";A.name=D.name;B.icons[D.name]=A};MarkerControl.prototype.loadMarkers=function(C){var D=this;var A=D.checkIconStatus(C.style.icon.x,C.style.icon.y);D.Options.newGeometryOptions.icon=new GIcon(D.icons[A.name]);var B=D.createMarker(new GLatLng(C.coordinates[0].lat,C.coordinates[0].lng),D.infoWindowHtml);D.storage[B.index].title=[C.title,C.title];D.storage[B.index].description=[C.description,C.description];D.zuper.map.addOverlay(B);return B}