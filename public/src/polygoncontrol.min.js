function PolygonControl(D){var A=this;A.type="polygon";A.name=A.type+"Control";A.zuper=null;A.digitizerShape=null;A.editLineHandler=null;A.endLineHandler=null;A.infoWindowHtml="";A.infoWindowTabs=[];A.styles={standard:{}};A.storage=[];A.Options={button_opts:{img_up_url:"http://www.google.com/intl/en_us/mapfiles/ms/t/Bpu.png",img_down_url:"http://www.google.com/intl/en_us/mapfiles/ms/t/Bpd.png",name:"polygon",tooltip:"Draw a shape"},position:{controlPosition:[245,3]},tooltip:{anchor:[-30,-8],cursor_on:"",cursor_off:"",titles:{start:"Click to start drawing a shape",middle:"Click to continue drawing a shape",end:"Click a vertex once, or double click on the map to end this shape"},callback:null},newGeometryOptions:{strokeColor:"#000000",strokeWeight:3,strokeOpacity:0.25,fillColor:"#0000FF",fillOpacity:0.45,opts:{clickable:true}},geometryListenerOpts:{mouseoverEditingEnabled:true,infoWindowHtmlEnabled:true,mouseoverHighlightingEnabled:true,infoWindowTabsEnabled:false,assembleInfoWindowTabs:function(){A.infoWindowTabs.push(new GInfoWindowTab("Geometry Controls",A.infoWindowHtml));A.infoWindowTabs.push(new GInfoWindowTab("Example Tab",A.zuper.infoWindowHtmlTemplates["infoWindowTabContent1"]))}},multiEdit:false,htmlTemplateParams:{},cssId:"emmc-polygon",optionalGeometryListeners:null,autoSave:false};if(typeof (D)!="undefined"){for(var C in D){if(typeof (D[C])==="object"){for(var B in D[C]){A.Options[C][B]=D[C][B]}}else{A.Options[C]=D[C]}}}else{}}PolygonControl.prototype=new GControl();PolygonControl.prototype.getDefaultPosition=function(){var A=this;return A.zuper.getDefaultPosition(A.Options.position)};PolygonControl.prototype.initialize=function(C){var B=this;B.container=document.createElement("div");B.container.id="mymaps-control-"+B.Options.button_opts.name;var A=B.zuper.createButton({controlName:B.name,button_opts:B.Options.button_opts,startDigitizing:function(){B.startDigitizing()},stopDigitizing:function(D){B.stopDigitizing(D)}});B.container.appendChild(A.img);C.getContainer().appendChild(B.container);B.runInitFunctions();return B.container};PolygonControl.prototype.runInitFunctions=function(){var A=this;A.tooltip();A.assembleInfoWindowHtml(A.Options.htmlTemplateParams);A.extendGPolygon()};PolygonControl.prototype.startDigitizing=function(){var B=this,D=B.zuper,C=D.map,A=B.Options;B.tooltip.on(A.tooltip.titles["start"]);B.digitizerShape=B.newGPolygon([],A.newGeometryOptions);C.addOverlay(B.digitizerShape);B.digitizerShape.enableDrawing({});B.editLineHandler=GEvent.addListener(B.digitizerShape,"lineupdated",function(){switch(B.digitizerShape.getVertexCount()){case 2:B.tooltip.tooltipContainer.innerHTML=A.tooltip.titles["middle"];break;case 3:B.tooltip.tooltipContainer.innerHTML=A.tooltip.titles["end"];break}});GEvent.addListener(B.digitizerShape,"cancelline",function(){B.stopDigitizing()});B.endLineHandler=GEvent.addListener(B.digitizerShape,"endline",function(H){var G=[];for(var F=0;F<B.digitizerShape.getVertexCount();F++){G[F]=B.digitizerShape.getVertex(F)}var E=B.createPolygon(G,B.infoWindowHtml);C.addOverlay(E);if(!A.multiEdit){B.stopDigitizing();GEvent.trigger(E,"click")}else{}})};PolygonControl.prototype.stopDigitizing=function(A){var B=this,D=B.zuper;try{GEvent.removeListener(B.endLineHandler)}catch(C){}B.tooltip.off();if(A!==false){D.toggleButtons()}D.setLocalTimeout(function(){if(B.digitizerShape){B.digitizerShape.disableEditing();D.map.removeOverlay(B.digitizerShape);B.digitizerShape=null}},500)};PolygonControl.prototype.tooltip=function(){var A=this;var B=A.zuper.tooltipFactory(A.Options.tooltip);A.tooltip=B;return B};PolygonControl.prototype.assembleInfoWindowHtml=function(B){var C=this,D=C.zuper,A=D.infoWindowHtmlTemplates;B=B||{};B["geometry_style_link"]=A["geometry_style_link_params"][0][C.type];C.infoWindowHtml=D.parseMicroTemplate("template_1",B,A["template_1"])+A["polygon_2"];if(C.Options.geometryListenerOpts.infoWindowTabsEnabled){C.Options.geometryListenerOpts.assembleInfoWindowTabs()}};PolygonControl.prototype.createPolygon=function(H,C,J,B){var E=this,F=E.Options;var I=(typeof (J)==="number")?false:true;var D=(I)?E.storage.length:J;var A=B||F.newGeometryOptions;var G=E.newGPolygon(H,A);G.index=D;G.savedStyle=A;G.unsavedStyle={};E.addGeometryListeners(G,C);if(I){E.storage[D]=new E.zuper.beans.Geometry({type:E.type,geometry:G})}else{E.storage[D].geometry=G}return G};PolygonControl.prototype.addGeometryListeners=function(B,A){var D=this,C=D.Options.geometryListenerOpts,E=D.zuper.map;if(C.mouseoverEditingEnabled){B.enableEditing({onEvent:"mouseover"});B.disableEditing({onEvent:"mouseout"})}if(C.infoWindowHtmlEnabled&&!C.infoWindowTabsEnabled){GEvent.addListener(B,"click",function(F){var G=F||B.getBounds().getCenter();E.openInfoWindowHtml(G,A);D.bindInfoWindow(B)})}if(C.infoWindowTabsEnabled&&!C.infoWindowHtmlEnabled){GEvent.addListener(B,"click",function(F){var G=F||B.getBounds().getCenter();E.openInfoWindowTabs(G,D.infoWindowTabs);D.bindInfoWindow(B)})}if(C.mouseoverHighlightingEnabled){GEvent.addListener(B,"mouseover",function(){B.setFillStyle({opacity:(B.unsavedStyle.fillOpacity||B.savedStyle.fillOpacity)+0.3})});GEvent.addListener(B,"mouseout",function(){B.setFillStyle({opacity:(B.unsavedStyle.fillOpacity||B.savedStyle.fillOpacity)})})}if(D.Options.optionalGeometryListeners){D.Options.optionalGeometryListeners()}return B};PolygonControl.prototype.bindInfoWindow=function(C){var D=this,A=D.Options,B=C.index;var E=(D.zuper.isIE)?get$("msiwsi").childNodes[0]:get$("msiwsi").childNodes[1];E.style.backgroundColor=C.savedStyle.fillColor;D.zuper.bindInfoWindow({index:B,storage:D.storage,geometryStyleFunc:function(){D.bindStyleInfoWindow(B)},undoStyling:function(){D.changeStyling(B,C.savedStyle);C.unsavedStyle={}},commitStyling:function(){for(var F in C.unsavedStyle){C.savedStyle[F]=C.unsavedStyle[F]}C.unsavedStyle={};for(var G in C.savedStyle){A.newGeometryOptions[G]=C.savedStyle[G]}}})};PolygonControl.prototype.bindStyleInfoWindow=function(F){var H=this,G=H.zuper.Options.cssId;var I=H.storage[F].geometry;var C=I.savedStyle;var A=I.unsavedStyle;var J=get$(G+"-line-color");var E=get$(G+"-line-width");var D=get$(G+"-line-opacity");var B=get$(G+"-fill-color");var K=get$(G+"-fill-opacity");var L=get$(G+"-style");J.style.backgroundColor=A.strokeColor||C.strokeColor;E.value=I.getStrokeWeight();D.value=I.getStrokeOpacity();B.style.backgroundColor=A.fillColor||C.fillColor;K.value=I.getFillOpacity();GEvent.addDomListener(J,"click",function(){H.zuper.showColorPicker({target:J,callback:function(M){H.changeStyling(F,{strokeColor:M})}})});GEvent.addDomListener(B,"click",function(){H.zuper.showColorPicker({target:B,callback:function(M){H.changeStyling(F,{fillColor:M})}})});GEvent.addDomListener(get$("emmc-geom-style-back"),"click",function(){H.changeStyling(F,{stroke:{color:C.strokeColor},fill:{color:C.fillColor}});L.style.display="none"});GEvent.addDomListener(get$("emmc-msls-ok"),"click",function(){var M=parseInt(I.setStrokeWeight(E.value));H.changeStyling(F,{strokeWeight:M,strokeOpacity:I.setStrokeOpacity(D.value),fillOpacity:I.setFillOpacity(K.value),strokeColor:J.style.backgroundColor,fillColor:B.style.backgroundColor});var N=(H.zuper.isIE)?get$("msiwsi").childNodes[0]:get$("msiwsi").childNodes[1];N.style.backgroundColor=B.style.backgroundColor;L.style.display="none"})};PolygonControl.prototype.changeStyling=function(E,K){var F=this;var H=F.storage[E].geometry;if(K){var I={},C=false,J={},D=false;for(var A in K){if(A.indexOf("stroke")>-1){var G=A.replace("stroke","").toLowerCase();I[G]=C=K[A]}if(A.indexOf("fill")>-1){var G=A.replace("fill","").toLowerCase();J[G]=D=K[A]}}if(C){H.setStrokeStyle(I)}if(D){H.setFillStyle(J)}for(var B in K){H.unsavedStyle[B]=K[B]}}};PolygonControl.prototype.hoverTooltip=function(){};PolygonControl.prototype.loadPolygons=function(A){var C=this;var B=C.createPolygon(A.coordinates,C.infoWindowHtml,false,A.style);C.storage[B.index].title=[A.title,A.title];C.storage[B.index].description=[A.description,A.description];C.zuper.map.addOverlay(B);return B};PolygonControl.prototype.newGPolygon=function(B,A){return new GPolygon(B,A.strokeColor,A.strokeWeight,A.strokeOpacity,A.fillColor,A.fillOpacity,A.opts)};PolygonControl.prototype.extendGPolygon=function(){GPolygon.unsavedStyle={};GPolygon.savedStyle={};GPolygon.prototype.getStrokeWeight=function(){return(this.unsavedStyle.strokeWeight||this.savedStyle.strokeWeight)};GPolygon.prototype.setStrokeWeight=function(A){if(!isNaN(A)){this.unsavedStyle.strokeWeight=(A>20)?20:(A<1)?1:A}else{this.unsavedStyle.strokeWeight=this.savedStyle.strokeWeight}return this.unsavedStyle.strokeWeight||this.savedStyle.strokeWeight};GPolygon.prototype.getStrokeOpacity=function(){return(this.unsavedStyle.strokeOpacity||this.savedStyle.strokeOpacity)*100};GPolygon.prototype.setStrokeOpacity=function(B){if(!isNaN(B)){var A=(B>100)?100:(B<0)?0:B;this.unsavedStyle.strokeOpacity=A/100}else{this.unsavedStyle.strokeOpacity=this.savedStyle.strokeOpacity}return this.unsavedStyle.strokeOpacity||this.savedStyle.strokeOpacity};GPolygon.prototype.getFillOpacity=function(){return(this.unsavedStyle.fillOpacity||this.savedStyle.fillOpacity)*100};GPolygon.prototype.setFillOpacity=function(B){if(!isNaN(B)){var A=(B>100)?100:(B<0)?0:B;this.unsavedStyle.fillOpacity=A/100}else{this.unsavedStyle.fillOpacity=this.savedStyle.fillOpacity}return this.unsavedStyle.fillOpacity||this.savedStyle.fillOpacity}}